<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自訂循環計時器</title>
    
    <!-- 這裡放置 CSS 樣式 -->
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }

        .timer-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            width: 350px;
        }

        .controls input {
            width: 60px;
            padding: 5px;
            margin: 5px 10px 15px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .display {
            margin-bottom: 20px;
        }

        #time-display {
            font-size: 4rem;
            font-weight: bold;
            color: #333;
        }

        #cycle-display {
            font-size: 1.2rem;
            color: #666;
        }

        .buttons button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        #start-button { background-color: #28a745; color: white; }
        #pause-button { background-color: #ffc107; color: black; }
        #reset-button { background-color: #dc3545; color: white; }

        #start-button:hover { background-color: #218838; }
        #pause-button:hover { background-color: #e0a800; }
        #reset-button:hover { background-color: #c82333; }
    </style>
</head>
<body>
    <div class="timer-container">
        <h1>循環計時器</h1>

        <div class="controls">
            <label for="minutes">時間 (分鐘):</label>
            <input type="number" id="minutes" min="0" value="0">
            <label for="seconds">時間 (秒):</label>
            <input type="number" id="seconds" min="0" max="59" value="10">
            <label for="cycles">重複次數:</label>
            <input type="number" id="cycles" min="1" value="3">
        </div>

        <div class="display">
            <div id="time-display">00:00</div>
            <div id="cycle-display">第 1 / 3 次</div>
        </div>
        
        <div class="buttons">
            <button id="start-button">開始</button>
            <button id="pause-button" style="display: none;">暫停</button>
            <button id="reset-button">重設</button>
        </div>
    </div>

    <!-- 這裡放置 JavaScript 邏輯 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 獲取 DOM 元素
            const minutesInput = document.getElementById('minutes');
            const secondsInput = document.getElementById('seconds');
            const cyclesInput = document.getElementById('cycles');
            const timeDisplay = document.getElementById('time-display');
            const cycleDisplay = document.getElementById('cycle-display');
            const startButton = document.getElementById('start-button');
            const pauseButton = document.getElementById('pause-button');
            const resetButton = document.getElementById('reset-button');

            let timerInterval = null;
            let totalSeconds;
            let remainingSeconds;
            let totalCycles;
            let currentCycle;
            let isRunning = false;

            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            function updateDisplay() {
                timeDisplay.textContent = formatTime(remainingSeconds);
                cycleDisplay.textContent = `第 ${currentCycle} / ${totalCycles} 次`;
            }

            function initializeTimer() {
                // 從輸入框獲取設定值
                const mins = parseInt(minutesInput.value) || 0;
                const secs = parseInt(secondsInput.value) || 0;
                totalCycles = parseInt(cyclesInput.value) || 1;
                
                totalSeconds = (mins * 60) + secs;

                if (totalSeconds <= 0 || totalCycles <= 0) {
                    alert("請輸入有效的時間和次數。");
                    return false;
                }

                remainingSeconds = totalSeconds;
                currentCycle = 1;
                updateDisplay();
                return true;
            }

            function startTimer() {
                if (isRunning) return;

                if (timerInterval === null && !initializeTimer()) {
                    return;
                }
                
                isRunning = true;
                startButton.style.display = 'none';
                pauseButton.style.display = 'inline-block';
                
                // 鎖定輸入框避免中途修改
                minutesInput.disabled = true;
                secondsInput.disabled = true;
                cyclesInput.disabled = true;

                timerInterval = setInterval(() => {
                    remainingSeconds--;
                    updateDisplay();

                    if (remainingSeconds <= 0) {
                        clearInterval(timerInterval);
                        // 播放提示音或震動（此處省略，可自行添加）

                        if (currentCycle < totalCycles) {
                            // 進入下一循環
                            currentCycle++;
                            remainingSeconds = totalSeconds;
                            // 短暫延遲後重新開始計時，以便使用者意識到循環結束
                            setTimeout(() => {
                                startTimer(); 
                            }, 500); 
                        } else {
                            // 所有循環完成
                            resetTimer();
                            alert("計時完成！");
                        }
                    }
                }, 1000);
            }

            function pauseTimer() {
                if (!isRunning) return;
                isRunning = false;
                clearInterval(timerInterval);
                timerInterval = null;
                startButton.style.display = 'inline-block';
                pauseButton.style.display = 'none';
            }

            function resetTimer() {
                pauseTimer(); // 先停止計時器
                timerInterval = null;
                isRunning = false;
                
                // 解鎖輸入框
                minutesInput.disabled = false;
                secondsInput.disabled = false;
                cyclesInput.disabled = false;

                // 重設顯示為初始值
                timeDisplay.textContent = "00:00"; 
                cycleDisplay.textContent = "設定完畢";
                
                startButton.style.display = 'inline-block';
                pauseButton.style.display = 'none';
            }

            // 事件監聽器
            startButton.addEventListener('click', startTimer);
            pauseButton.addEventListener('click', pauseTimer);
            resetButton.addEventListener('click', resetTimer);

            // 初始設置顯示
            updateDisplay();
            cycleDisplay.textContent = "設定完畢";
        });
    </script>
</body>
</html>
